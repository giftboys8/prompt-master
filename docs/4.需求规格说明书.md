# 需求规格说明书

## 1. 系统概述
**系统名称**：PromptMaster  
**系统目标**：为用户提供高效、灵活的提示词管理、内容生成和协作工具，支持多场景应用和团队协作。

**核心功能**：
- 智能场景匹配与管理
- 提示词框架设计与组装
- 模型调用与内容生成
- 版本控制与历史管理
- 团队协作与审核流程
- 多维度测试与性能优化

**版本管理特性**：
- 标准化版本号格式（V-主版本-子版本）
- 支持主版本和子版本的独立管理
- 版本历史记录与比较功能
- 灵活的版本回滚机制

## 2. 用户角色
1. **管理员**：
   - 负责系统配置、用户管理和权限分配。
   - 监控系统运行状态，处理异常情况。
2. **普通用户**：
   - 使用系统进行提示词管理、内容生成和编辑。
   - 可以创建、编辑和删除自己的场景和提示词框架。
3. **团队用户**：
   - 在团队中共享场景、提示词框架和生成内容。
   - 支持协作编辑和批量操作。

## 3. 核心功能
### 3.1 场景管理
- **智能场景匹配**：系统自动显示TOP3推荐场景，基于用户历史记录和行为分析。
- **模板市场**：提供行业标杆场景模板，支持一键克隆和自定义配置。
- **场景效能看板**：实时显示场景关联指标（调用次数、成功率等）。
- **自定义场景**：用户可创建和编辑自定义场景，支持多种分类（教育、营销、技术等）。

### 3.2 提示词框架管理
- **提示词框架组装**：
  - 可视化拖拽工作台，支持模块自由组合与连接线绘制
  - 智能推荐引擎，根据关键词（如\"步骤\"、\"分析\"）推荐适合的框架
  - 复杂度评估器，预测token消耗及生成耗时
- **提示词模式管理**：
  - 三级模式体系（基础模式、任务类型、专业等级）
  - 提供常见框架模板（如RTGO、SPAR等）
  - 模式切换预览，对比不同模式下的生成效果差异
- **填写提示词**：
  - 增强型编辑器，支持动态变量库和上下文感知提示
  - 多模态嵌入，支持插入表格模板/示意图占位符
  - 模块化提示词管理，支持单独编辑和组合不同模块
- **提示词测试与审核**：
  - 三级审核机制（自动初筛、交叉复审、终审仲裁）
  - 审核知识库，自动归档经典案例形成审核标准手册
- **版本控制系统**：
  - 标准化版本号格式（V-主版本-子版本），如V-01-05
  - 主版本和子版本独立管理，支持重大更新和小型迭代
  - 版本历史记录与比较功能，支持任意版本间差异对比
  - 版本回滚机制，可一键恢复到任意历史版本

### 3.3 模型调用
- 基于Dify平台进行模型调用，支持本地和远程模型的统一管理。
- 提供批量调用功能，支持并发生成内容。
- 用户可配置生成参数（如生成长度、温度参数、top-p值等）。
- **沙盒实验环境**：支持在不影响生产数据的前提下进行框架实验。

### 3.4 内容生成与管理
- 支持实时预览生成内容，用户可即时调整提示词或参数。
- 提供批量生成功能，支持从文件或数据库中选择提示词。
- 支持对生成内容的增删改查操作，提供高效检索和批量操作功能。
- **合规审查引擎**：实时敏感词检测和行业规范检查。

### 3.5 多维度测试验证
- **分层测试方案**：单元测试（提示词完整性检查）、集成测试（场景全流程模拟）、压力测试（并发请求测试）。
- **A/B测试平台**：支持并行发布多个提示词版本进行效果对比。
- **测试报告**：提供响应时间分布图和错误类型统计表。

### 3.6 团队协作与审核管理
- **团队共享**：支持共享场景、提示词框架和生成内容。
- **权限管理**：设置团队成员对共享资源的使用权限（如只读、编辑）。
- **审核流程**：配置三级审核机制，包括自动初筛、交叉复审和终审仲裁。
- **审核知识库**：查看历史审核记录和行业审核标准。

### 3.7 系统监控与管理
- **操作日志**：记录用户操作和系统活动。
- **模型调用日志**：监控模型调用情况和性能指标。
- **新增监控指标**：场景推荐准确率、审核仲裁通过率、压力测试达标率。
- **报警规则**：配置异常情况的自动报警机制。

### 3.8 API与集成
- **RESTful API**：提供完整的API接口，便于与其他系统集成。
- **批量处理**：支持批量导入/导出数据。
- **第三方集成**：支持与CRM系统等第三方应用的数据交换。

## 4. 技术实现
### 4.1 前端
- **框架与库**：
  - 使用Vue.js 3构建用户界面，采用Composition API提高代码复用性。
  - 集成Element Plus组件库，提供统一的UI体验。
  - 使用Vuex 4进行状态管理，处理复杂的数据流。
  - 引入ECharts实现数据可视化，展示监控指标和测试报告。
- **交互设计**：
  - 实现可视化拖拽工作台，支持模块自由组合与连接线绘制。
  - 开发增强型编辑器，支持动态变量库和上下文感知提示。
  - 设计响应式布局，适配不同设备和屏幕尺寸。
- **性能优化**：
  - 使用Vue虚拟滚动技术处理大量数据的渲染。
  - 实现组件懒加载，优化首屏加载速度。
  - 采用WebSocket技术实现实时预览和通知功能。

### 4.2 后端
- **框架与API**：
  - 使用Python Django构建RESTful API后端服务。
  - 实现GraphQL API，支持灵活的数据查询。
  - 采用Django Channels处理WebSocket连接。
- **模型集成**：
  - 集成Dify平台进行模型调用，支持多种大模型（如GPT、LLaMA、OpenAI API等）。
  - 开发模型调用适配器，统一不同模型的接口。
  - 实现模型调用缓存机制，提高响应速度和降低成本。
- **智能推荐系统**：
  - 基于用户历史行为的协同过滤算法。
  - 使用NLP技术进行关键词匹配和语义分析。
  - 实现自适应学习机制，提高推荐精度。
- **审核与安全**：
  - 开发三级审核流水线，支持自动初筛、交叉复审和终审仲裁。
  - 实现实时敏感词检测和行业规范检查。
  - 采用JWT认证和RBAC权限控制系统。
- **版本控制系统**：
  - 实现自定义版本号生成器，支持V-XX-YY格式。
  - 开发版本比较算法，支持任意两个版本间的差异对比。
  - 实现版本树数据结构，支持复杂的版本分支管理。
  - 开发版本回滚机制，包括数据完整性检查和冲突解决策略。
  - 实现版本元数据管理，记录每个版本的创建者、时间戳和变更说明。

### 4.3 数据库
- **关系型数据库**：
  - 使用PostgreSQL存储结构化数据：
    - 用户账户和权限信息
    - 场景和提示词框架的基本信息
    - 团队和协作关系
    - 系统配置和参数
    - 版本控制相关数据：
      - 模板版本表（主版本号、子版本号、创建时间、创建者）
      - 模板内容表（版本ID、内容、模块数据JSON）
      - 版本元数据表（版本ID、备注、标签）
  - 实现数据分区策略，优化查询性能。
  - 设计完善的索引结构，支持复杂查询。
- **非关系型数据库**：
  - 使用MongoDB存储非结构化和半结构化数据：
    - 生成内容的版本历史
    - 用户行为日志
    - 大规模测试结果
    - 审核知识库案例
  - 实现数据自动分片，支持水平扩展。
- **缓存系统**：
  - 使用Redis作为缓存层，存储频繁访问的数据。
  - 实现分布式锁机制，处理并发请求。

### 4.4 测试与质量保障
- **测试框架**：
  - 使用Jest进行前端单元测试和组件测试。
  - 采用Pytest进行后端单元测试和集成测试。
  - 使用Cypress进行端到端测试。
- **性能测试**：
  - 使用JMeter进行压力测试和负载测试。
  - 实现自定义性能监控指标和报告。
- **持续集成/持续部署**：
  - 使用GitHub Actions或Jenkins实现CI/CD流程。
  - 自动化代码质量检查和测试执行。

### 4.5 部署与运维
- **容器化**：
  - 使用Docker容器化应用组件。
  - 采用Docker Compose进行本地开发和测试。
  - 使用Kubernetes进行生产环境编排和管理。
- **部署选项**：
  - 支持本地部署和云部署（AWS、Azure、Google Cloud）。
  - 提供一键部署脚本，简化安装过程。
- **监控与告警**：
  - 使用Prometheus收集系统指标。
  - 采用Grafana进行可视化监控。
  - 实现自定义告警规则和通知渠道。
- **日志管理**：
  - 集中式日志收集和分析系统。
  - 支持日志搜索和异常检测。

### 4.6 安全与合规
- **数据安全**：
  - 实现数据加密存储和传输。
  - 定期数据备份和恢复机制。
- **访问控制**：
  - 细粒度的权限管理系统。
  - 多因素认证选项。
- **合规检查**：
  - 自动化合规检查工具。
  - 定期更新的敏感词库和行业规范库。

## 5. 示例工作流
1. **智能场景匹配**：
   - 用户进入"场景推荐"页面，系统自动显示TOP3推荐场景。
   - 用户浏览"模板市场"中的行业标杆场景模板。
   - 用户选择"营销文案"模板，并使用场景克隆功能快速创建。

2. **创建和配置场景**：
   - 用户进入"场景管理"页面，点击"创建场景"按钮。
   - 输入场景名称"营销文案生成"和描述。
   - 选择默认模板或自定义场景参数，保存场景。

3. **定义提示词框架**：
   - 用户进入"提示词框架管理"页面。
   - 使用智能推荐功能，输入关键词"广告"获取框架建议。
   - 用户拖拽模块到画布，组装RTGO（角色、任务、目标、输出）框架。
   - 填写具体内容：角色（广告文案撰写人），任务（生成吸引人的广告文案），目标（针对年轻用户），输出（不超过100字的文案）。
   - 点击"复杂度评估"查看预测资源消耗。

4. **调用模型生成内容**：
   - 用户进入"模型调用"页面，选择Dify平台上的GPT模型。
   - 配置生成参数：温度0.7，top-p值0.9，最大输出长度100。
   - 点击"生成"按钮，系统批量生成10条广告文案并实时预览。

5. **管理生成内容**：
   - 用户进入"内容管理"页面，查看生成的文案列表。
   - 对文案进行编辑、删除或标记为优选。
   - 使用批量导出功能，将优选文案导出为CSV文件。

6. **团队协作与审核**：
   - 用户进入"团队管理"页面，邀请团队成员加入。
   - 配置三级审核机制：设置自动初筛阈值为65%通过率。
   - 分配交叉复审任务给3名团队成员。
   - 使用审核知识库中的"广告文案"标准进行最终审核。

7. **多维度测试验证**：
   - 用户进入"测试中心"，选择单元测试检查提示词完整性。
   - 执行压力测试，模拟100个并发用户，设置请求间隔0.1秒。
   - 查看测试报告，关注响应时间分布和错误类型统计。

8. **系统监控与优化**（管理员操作）：
   - 管理员进入"系统监控"页面，查看新增的监控指标。
   - 分析场景推荐准确率（目标>75%）和审核仲裁通过率（目标60-80%）。
   - 根据监控数据，调整系统参数以优化性能和用户体验。

## 6. 系统操作指南
### 6.1 智能场景匹配与创建
1. 登录系统，进入\"场景推荐\"页面。
2. 浏览系统自动显示的TOP3推荐场景。
3. 点击\"模板市场\"，选择适合的行业标杆场景模板。
4. 使用场景克隆功能：
   - 选择\"快速克隆\"自动继承模板参数，或
   - 选择\"自定义克隆\"手动调整配置项。
5. 在\"场景管理\"页面，点击\"创建场景\"按钮，输入场景名称和描述。
6. 选择默认模板或自定义场景参数，保存场景。

### 6.2 定义提示词框架
1. 进入\"提示词框架管理\"页面。
2. **智能推荐**：输入关键词（如\"步骤\"、\"分析\"）获取框架建议。
3. **提示词框架组装**：
   - 使用可视化拖拽工作台，将左侧模块拖到画布完成框架组装。
   - 点击\"复杂度评估\"查看预测资源消耗。
4. **提示词模式管理**：
   - 选择适合的模式类型（初级模式或高级模式）。
   - 根据任务类型和专业等级调整模式参数。
5. **填写提示词**：
   - 使用增强型编辑器填写具体的提示词内容。
   - 利用动态变量库和上下文感知提示优化提示词。
6. **提示词测试与审核**：
   - 在沙盒环境中测试提示词效果。
   - 提交审核，等待三级审核流程完成。

### 6.3 版本管理
1. **创建新版本**：
   - 在提示词框架编辑页面，点击"创建新版本"按钮。
   - 选择创建主版本（如V-02-00）或子版本（如V-01-03）。
   - 输入版本说明，描述此次更新的主要内容。
2. **查看版本历史**：
   - 在提示词框架详情页，点击"版本历史"标签。
   - 浏览所有历史版本，包括版本号、创建时间、创建者和版本说明。
3. **比较版本差异**：
   - 在版本历史列表中，选择两个版本进行比较。
   - 系统将以并排或内联方式展示两个版本的差异。
4. **回滚版本**：
   - 在版本历史列表中，找到需要回滚的目标版本。
   - 点击"回滚到此版本"按钮。
   - 确认回滚操作，系统将创建一个新的版本，内容与目标版本相同。
5. **设置版本标签**：
   - 为重要的版本添加标签，如"稳定版"、"生产版"等。
   - 使用标签快速筛选和切换不同用途的版本。

### 6.3 调用模型生成内容
1. 进入"模型调用"页面，选择Dify平台上的本地或远程模型。
2. 配置生成参数（如生成长度、温度参数、top-p值等）。
3. 设置批量生成参数（如并发数、生成数量）。
4. 点击"生成"按钮，系统批量生成内容并实时预览。
5. 使用合规审查引擎实时检查生成内容的合规性。

### 6.4 管理生成内容
1. 进入"内容管理"页面，查看生成的内容列表。
2. 使用高级筛选和检索功能快速定位内容。
3. 对内容进行编辑、删除或标记为优选。
4. 使用批量操作功能处理多条内容。
5. 支持批量导出优选内容为CSV或JSON文件。

### 6.5 团队协作与审核管理
1. 进入"团队管理"页面，邀请团队成员加入。
2. 配置审核流程：
   - 在"审核设置"中启用三级审核机制。
   - 设置自动初筛阈值（建议60-70%通过率）。
   - 配置交叉复审人员池。
3. 共享场景、提示词框架和生成内容。
4. 设置团队成员对共享资源的使用权限。
5. 使用审核知识库：
   - 查看历史审核记录。
   - 使用标签检索特定行业审核标准。

### 6.6 多维度测试验证
1. 进入"测试中心"，选择测试类型：
   - 单元测试：检查单个提示词要素完整性。
   - 集成测试：执行场景全流程模拟。
   - 压力测试：设置并发用户数、请求间隔和超时阈值。
2. 执行A/B测试：
   - 创建多个提示词版本。
   - 设置测试参数和评估指标。
   - 启动并行测试。
3. 查看测试报告：
   - 分析响应时间分布图。
   - 检查错误类型统计表。
   - 评估A/B测试结果，选择最优版本。

### 6.7 系统监控与管理（仅管理员）
1. 进入"系统监控"页面。
2. 查看新增监控指标：
   - 场景推荐准确率（目标>75%）
   - 审核仲裁通过率（正常范围60-80%）
   - 压力测试达标率（要求100%）
3. 分析操作日志和模型调用日志。
4. 配置和调整报警规则。
5. 基于监控数据优化系统性能和用户体验。

### 6.8 API使用与系统集成
1. 访问API文档页面，了解可用的API端点和参数。
2. 使用API密钥进行身份验证。
3. 集成批量处理功能，实现大规模数据导入/导出。
4. 配置与第三方系统（如CRM）的数据交换接口。

### 6.9 注意事项
1. 使用沙盒环境时：
   - 实验数据保存周期为7天。
   - 最多同时运行3个实验实例。
2. 智能推荐功能的精度会随使用次数提升。
3. 审核仲裁委员会需要至少配置5名管理员。
4. 定期检查和更新敏感词库和行业规范，确保内容合规性。
5. 在进行大规模批量操作前，建议先在小范围测试。