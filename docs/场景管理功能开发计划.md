# 场景管理功能开发计划

## 第一阶段：基础场景管理（3天）

### 1. 后端开发（1天）

#### 1.1 数据模型设计
```python
# api/models.py
class Scene(models.Model):
    name = models.CharField(max_length=100, verbose_name='场景名称')
    description = models.TextField(blank=True, verbose_name='场景描述')
    tags = models.ManyToManyField('SceneTag', blank=True, verbose_name='标签')
    created_by = models.ForeignKey(User, on_delete=models.CASCADE, verbose_name='创建者')
    created_at = models.DateTimeField(auto_now_add=True, verbose_name='创建时间')
    updated_at = models.DateTimeField(auto_now=True, verbose_name='更新时间')
    
class SceneTag(models.Model):
    name = models.CharField(max_length=50, unique=True, verbose_name='标签名称')
    color = models.CharField(max_length=20, default='#1890ff', verbose_name='标签颜色')
```

#### 1.2 API 开发
1. 场景管理 API
   ```python
   # 场景列表（支持分页、筛选、排序）
   GET /api/scenes/
   
   # 场景详情
   GET /api/scenes/{id}/
   
   # 创建场景
   POST /api/scenes/
   
   # 更新场景
   PUT /api/scenes/{id}/
   
   # 删除场景
   DELETE /api/scenes/{id}/
   ```

2. 标签管理 API
   ```python
   # 标签列表
   GET /api/scene-tags/
   
   # 创建标签
   POST /api/scene-tags/
   
   # 删除标签
   DELETE /api/scene-tags/{id}/
   ```

### 2. 前端开发（2天）

#### 2.1 场景列表页面（1天）
1. 组件结构
   ```vue
   components/
   ├── scene/
   │   ├── SceneList.vue          # 场景列表主组件
   │   ├── SceneCard.vue          # 场景卡片组件
   │   ├── SceneFilterPanel.vue   # 筛选面板组件
   │   └── SceneTagSelect.vue     # 标签选择组件
   ```

2. 功能实现
   - 场景列表展示（支持列表/网格视图切换）
   - 搜索功能（按名称、描述）
   - 筛选功能（按标签、创建时间）
   - 排序功能（按创建时间、更新时间）
   - 批量操作（删除、标签管理）

#### 2.2 场景编辑页面（1天）
1. 组件结构
   ```vue
   components/
   ├── scene/
   │   ├── SceneForm.vue          # 场景表单组件
   │   ├── SceneTagManager.vue    # 标签管理组件
   │   └── ScenePreview.vue       # 场景预览组件
   ```

2. 功能实现
   - 场景基本信息编辑（名称、描述）
   - 标签管理（添加、删除标签）
   - 表单验证
   - 自动保存
   - 预览功能

### 3. 数据流设计

#### 3.1 Vuex Store 结构
```javascript
// store/modules/scene.js
state: {
  scenes: [],
  currentScene: null,
  tags: [],
  loading: false,
  error: null,
  filters: {
    search: '',
    tags: [],
    dateRange: null,
    sortBy: 'created_at',
    sortOrder: 'desc'
  },
  pagination: {
    current: 1,
    pageSize: 10,
    total: 0
  }
}
```

#### 3.2 主要 Actions
```javascript
// 场景相关
fetchScenes        // 获取场景列表
createScene        // 创建场景
updateScene        // 更新场景
deleteScene        // 删除场景
batchDeleteScenes  // 批量删除场景

// 标签相关
fetchTags         // 获取标签列表
createTag         // 创建标签
deleteTag         // 删除标签
updateSceneTags   // 更新场景标签
```

### 4. API 接口定义

#### 4.1 场景管理接口
```javascript
// 场景列表
GET /api/scenes/
Request:
{
  page: number,
  page_size: number,
  search?: string,
  tags?: number[],
  start_date?: string,
  end_date?: string,
  sort_by?: string,
  sort_order?: 'asc' | 'desc'
}
Response:
{
  results: Array<Scene>,
  total: number,
  page: number,
  page_size: number
}

// 创建场景
POST /api/scenes/
Request:
{
  name: string,
  description?: string,
  tags?: number[]
}
Response: Scene

// 更新场景
PUT /api/scenes/{id}/
Request:
{
  name?: string,
  description?: string,
  tags?: number[]
}
Response: Scene

// 删除场景
DELETE /api/scenes/{id}/
Response: 204 No Content
```

#### 4.2 标签管理接口
```javascript
// 标签列表
GET /api/scene-tags/
Response: Array<Tag>

// 创建标签
POST /api/scene-tags/
Request:
{
  name: string,
  color?: string
}
Response: Tag

// 删除标签
DELETE /api/scene-tags/{id}/
Response: 204 No Content
```

### 5. 开发步骤

#### Day 1: 后端开发
1. [ ] 创建 Scene 和 SceneTag 模型
2. [ ] 实现场景管理 API
3. [ ] 实现标签管理 API
4. [ ] 编写单元测试
5. [ ] API 文档生成

#### Day 2: 前端场景列表页面
1. [ ] 创建必要的 Vue 组件
2. [ ] 实现 Vuex store 模块
3. [ ] 实现场景列表展示
4. [ ] 实现筛选和排序功能
5. [ ] 实现批量操作功能

#### Day 3: 前端场景编辑页面
1. [ ] 创建场景表单组件
2. [ ] 实现标签管理功能
3. [ ] 实现表单验证
4. [ ] 实现自动保存功能
5. [ ] 实现预览功能
6. [ ] 进行集成测试

### 6. 测试计划

#### 6.1 单元测试
- 后端模型测试
- API 接口测试
- 前端组件测试
- Vuex store 测试

#### 6.2 集成测试
- 场景 CRUD 操作流程
- 标签管理流程
- 筛选和排序功能
- 批量操作功能

#### 6.3 性能测试
- 场景列表加载性能
- 批量操作性能
- 自动保存性能

### 7. 上线检查清单
- [ ] 数据库索引优化
- [ ] API 响应时间检查
- [ ] 前端性能检查
- [ ] 错误处理完整性
- [ ] 用户权限验证
- [ ] 数据验证完整性
- [ ] 浏览器兼容性测试
- [ ] 响应式布局测试